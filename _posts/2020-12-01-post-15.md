---
layout: post
title: 'Kakaotalk 데이터 가지고 놀기(2)'
description: '# 벌써_12월_아직_솔로'
date: 2020-12-01 20:16:41 +0900
categories: R Data
---
## 카카오톡 대화 내용 가져오기
[이전 포스팅][before]에서 서술한 것처럼 카카오 API에서는 대화 내용을 제공하지 않지만, 카카오톡 어플리케이션에서 대화내용을 추출할 수가 있습니다.

### 참조
[카카오톡 내보내기 텍스트, 사진, 동영상 내부저장소 저장하는 방법][export]

### 스마트폰과 컴퓨터에서의 차이점?
먼저, 스마트폰에서 가져온 대화내용입니다.
```
XX방 n명 카카오톡 대화
저장한 날짜 : 2020년 11월 30일 오후 8:39


2020년 11월 9일 오전 6:42
2020년 11월 9일 오전 6:42, 코딩노예님이 uowol님을 초대했습니다.
2020년 11월 9일 오전 6:42, 코딩노예 : .
2020년 11월 9일 오전 6:42, uowol : ㅎㅇㅎㅇ!
2020년 11월 9일 오전 6:42, uowol : @----->
```

다음은 컴퓨터 카카오톡에서 가져온 내용입니다.
```
XX방 님과 카카오톡 대화
저장한 날짜 : 2020-12-01 17:05:53

--------------- 2020년 11월 9일 월요일 ---------------
코딩노예님이 uowol님을 초대하였습니다.
[코딩노예] [오전 6:42] .
[uowol] [오전 6:42] ㅎㅇㅎㅇ!
[uowol] [오전 6:42] 반가워요 ㅎㅎㅋ
[uowol] [오전 6:42] @----->
```

그럼 이 둘 중에 어떤 데이터를 사용할 것인지를 정해야 하는데, 

저는 이 참에 정규표현식도 복습할 겸 더 복잡해보이는 컴퓨터 버젼의 데이터를 선택했습니다.

---

## 투머치토커는 누구?
오늘은 데이터를 다루는데 뛰어난 성능을 보여주는 R언어를 사용하여 대화 내용을 분석해보려고 합니다.

### stringr 패키지 사용하기

먼저,

```R
# R > regularExpression.R

# install.packages('stringr') # 만약 설치가 안되어있다면 이것을 먼저 실행해야합니다.
library(stringr)
```

이번 프로그램은 문자열을 주로 다룰 것이기 때문에 관련된 라이브러리를 사용한다고 명시해줍니다.

정규표현식은 따로 명시하지 않아도 사용할 수 있습니다.

### 파일 읽어오기
저는 `C:\Users\uowol\Documents\dev`에 `R`이라는 폴더를 만들어 작업을 진행하고 있습니다.

![folder](/assets/imgs/post_15/folder.PNG "작업 폴더입니다")

이 때, R에서 자신이 작업하고 있는 폴더를 알고 싶다면 `getwd()`명령어를 통해 알 수 있고 `setwd()`명령어로 작업공간을 설정할 수 있습니다.

```R
getwd()
# > source("c:\\Users\\uowol\\Documents\\dev\\R\\regularExpression.R", encoding $
# [1] "C:/Users/uowol/Documents/dev"
```

계속해서 작업공간에 대한 이야기를 하고 있는 이유는

```R
# R > regularExpression.R
...
PATH = "R/KakaoTalkChats_오리방.txt"
...
```

파일을 이와 같이 **상대경로**로 읽어오기 위해서입니다.

제 작업공간이 `C:\Users\uowol\Documents\dev`이므로, 

`KakaoTalkChats_오리방.txt`파일에 접근하려면 `R/KakaoTalkChats_오리방.txt`, 

즉 `R`폴더에 들어가 `KakaoTalkChats_오리방.txt`에 접근하면 되는 것 입니다.

```R
# R > regularExpression.R
...
data = readLines(PATH, encoding="UTF-8") # 한국어를표시하기 위한 utf-8
...
```

여기서 `readLines("파일의 경로")`함수는 파일의 내용을 줄 단위로 잘라 vector형태로 값을 반환합니다.

예를 들어, 
```R
# test.text

대충 A라는 내용
대충 B라는 내용
대충 C라는 내용
```
라는 파일을 읽는다면

["대충 A라는 내용", "대충 B라는 내용", "대충 C라는 내용"]의 vector가 만들어집니다.

이를 활용하여 카카오톡 대화방을 긁어와보겠습니다.

### 정규표현식을 사용하여 대화 분리하기

긁어온 대화 내용을 보면 유형이 5가지로 나누어집니다.

1. --------------- 20XX년 XX월 XX일 X요일 ---------------

2. ~님이 ~을 초대하였습니다.

3. ~님이 나갔습니다.

4. [이름] [오전/오후 XX:XX] 내용

5. 그냥 내용
    - 한 줄씩 긁어오다보니 여러 줄의 내용을 채팅했을 경우, 이렇게 한 줄씩 내용만 긁어와질 때가 있습니다.
    - 이 때는 가장 최근에 메시지를 보낸 사람의 대화내용에 추가하면 됩니다.

이제, 정규표현식을 R에서 사용하는 법을 간략하게 알아보겠습니다.

훨씬 많은 활용법이 있지만 자세한 내용은 다음 포스팅에 다뤄보겠습니다.

```R
# 1. 
grep(RegExp, vector)
# 벡터 내에 매개변수로 들어간 정규표현식이 포함된 문자열이 있다면 해당 위치를 반환합니다.
# 만약 여러 개가 부합한다면 여러 개의 위치를 반환합니다.
# value=TRUE를 매개변수로 넣는다면 위치가 아닌 해당 문자열을 반환합니다.

# 2.
grepl(RegExp, vector)
# 결과값이 위치가 아니라 TRUE/FALSE값으로 나옵니다.
# ex) True True False True
```


```
# 첫번째, --------------- 20XX년 XX월 XX일 X요일 ---------------
chat_date = grep("-+ 20\\d+년 \\d+월 \\d+일 [가-힣]+요일 -+", data)

# 두번째, ~님이 ~을 초대하였습니다.
chat_invite = grep(".+님이 .+님을 초대하였습니다.", data)

# 세번째, ~님이 나갔습니다.
chat_left = grep('.+님이 나갔습니다.', data)

# 네번째, [이름] [오전/오후 XX:XX] 내용
idx_chat = grep("\\[.+\\] \\[오전?후? \\d+:\\d+\\] .+", data)

# 다섯번째, 그냥 내용

```


[export]: https://en4u.co.kr/%EC%B9%B4%EC%B9%B4%EC%98%A4%ED%86%A1%EB%82%B4%EB%B3%B4%EB%82%B4%EA%B8%B0/
[before]: posts/post-14